
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Seeking Simplicity</title>
  <meta name="author" content="Matt Stine">

  
  <meta name="description" content="I gave two lightning talks at CommunityOne today, the first of which described deploying Grails applications to Morph AppSpace. For the uninitiated, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mattstine.com/blog/page/5">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Seeking Simplicity" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8534802-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Seeking Simplicity</a></h1>
  
    <h2>A blog about DevOps, clouds, architecture, and everything else...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mattstine.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/06/01/deploying-grails-to-morph-appspace-communityone-2009-lightning-talk/">Deploying Grails to Morph AppSpace: #CommunityOne 2009 Lightning Talk</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-01T23:56:06-05:00" pubdate data-updated="true">Jun 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I gave two lightning talks at <a href="http://developers.sun.com/events/communityone/2009/west/index.jsp">CommunityOne</a> today, the first of which described deploying <a href="http://grails.org">Grails</a> applications to <a href="http://mor.ph/products_appspace">Morph AppSpace</a>.</p>

<p>For the uninitiated, Grails is a Ruby on Rails inspired full stack web development framework which brings &#8220;convention over configuration&#8221; and &#8220;DRY&#8221; into the Java web development arena. Unlike Rails, it is not an effort from scratch, but rather stands on the shoulders of proven giants in the Java world like the Spring framework and Hibernate. It does this using Groovy, the popular dynamic scripting language for the JVM, as a sort of &#8220;DSL for web development.&#8221; Find it at <a href="http://grails.org">http://grails.org</a>.</p>

<p>Morph AppSpace on the other hand is a fully-configured and managed environment for hosting web applications, and currently supports Java, Grails, Rails, and PHP applications. It is a &#8220;platform as a service&#8221; (PaaS) provider that abstracts away the details of Amazon EC2 and S3 technologies. Systems architecture, backups, monitoring, failover, scalability - all of this is handled by Morph. You simply develop and deploy your application - Morph does the rest. Find it at <a href="http://mor.ph/products_appspace">http://mor.ph/products_appspace</a>.</p>

<p>So to get going, visit <a href="http://mor.ph">http://mor.ph</a> and sign up for a free developer account. Create yourself a Java application subscription, and pick your choice of database (MySQL or PostgreSQL). Create the database, and then download two very important files into the root directory of your Grails project: deployment.properties, which contains the metadata describing your application to the Morph AppSpace platform, and morph_deployer.jar, which contains the client API to the platform.</p>

<p>Next you&#8217;ll need to install the <a href="http://grails.org/plugin/morph-deploy">Grails morph-deploy plugin</a>. If you&#8217;re using Grails 1.1, you&#8217;ll need to checkout <a href="https://svn.codehaus.org/grails-plugins/grails-morph-deploy/trunk/">the trunk version from SVN</a>, as the version in the plugin repository is not 1.1 ready. Install this plugin locally by running &#8220;grails install-plugin $PATH_TO_PLUGIN.&#8221; Next, you&#8217;ll need to edit DataSource.groovy to contain the following:</p>

<pre><code>production {
        dataSource {
            driverClassName = 'com.mysql.jdbc.Driver'
            dbCreate = "update"
            jndiName = "java:comp/env/jdbc/morph-ds"
            dialect = 'org.hibernate.dialect.MySQLDialect'
        }
}
</code></pre>

<p>Finally, run &#8220;grails war&#8221; to build the war file, and &#8220;grails deploy&#8221; to upload your application to the platform. Once the upload is complete, visit the management interface and check the logs to see that you&#8217;ve successfully deployed. Once it&#8217;s finished, click on the link to your application. Happy Grails on the cloud!</p>

<p>Here&#8217;s the screencast from my talk. Enjoy!</p>

<p>[youtube=http://www.youtube.com/watch?v=JYPJ26-1YTM&hl;=en&fs;=1&border;=1]</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/06/01/connecting-with-people-at-javaone/">Connecting With People at #JavaOne</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-01T23:34:24-05:00" pubdate data-updated="true">Jun 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So far one of the greatest things about JavaOne for me has been the opportunity to connect face-to-face with so many people that I&#8217;ve only communicated with digitally. I&#8217;ve also been able to catch up with folks that I&#8217;ve run into through other conferences, the JUG, and work:</p>

<ul>
<li><p>Finally met Aaron Houston and Mark DeHart from <a href="http://java.sun.com/community/usergroups/index.jsp">Sun JUG Programs</a>. These guys have supported the Memphis JUG from the very beginning and have kept us supplied with tons of cool swag, as well as a Sun SPOT that continues to be a hit. Great guys.</p></li>
<li><p>Briefly chatted with <a href="http://weblogs.java.net/blog/caroljmcdonald/">Carol McDonald </a>from Sun. She was our very first JUG speaker and also had an extremely stressful encounter with our then new projector.</p></li>
<li><p>Got to catch up with <a href="http://blog.springsource.com/author/keithd/">Keith Donald</a> of SpringSource on what he&#8217;s been up to with Spring and what we&#8217;ve been up to with our SRM project. Keith joined us for a week long consulting engagement earlier this year and fit in like another member of the team. He and Oleg Zhurakousky covered the JUG meeting that week as well and we had our largest attendance ever.</p></li>
<li><p>Finally met <a href="http://weblogs.java.net/blog/van_riper/">Van Riper</a>, the man behind JUG-USA.</p></li>
<li><p>Had a great dinner conversation with Abdel Remani, student JUG leader from California State University, Chico.</p></li>
<li><p>Got to catch up with <a href="http://www.linkedin.com/in/davidgbooth">Dave Booth</a>, formerly the JUG program guy from JetBrains, now with GravityGears.</p></li>
<li><p>Briefly chatted with <a href="http://www.linkedin.com/pub/wayne-fay/4/326/193">Wayne Fay</a>, one of our former JUG members now working in San Francisco.</p></li>
</ul>


<p>All in all it has been wonderful getting to connect with all of these folks, put faces to names, and share updates. Come to JavaOne. You get to meet neat folks!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/06/01/on-the-ground-in-san-francisco/">On the Ground in San Francisco&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-01T00:39:22-05:00" pubdate data-updated="true">Jun 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&#8230;for my second trip to JavaOne. This is going to be an extremely busy week.</p>

<p>Just as a quick update to those who thought I have fallen off of the face of the earth, I&#8217;ve been very busy these past few weeks finishing up a lot of loose ends. First off, May is a busy month for our family. With Mother&#8217;s Day, Wendy&#8217;s 30th Birthday, and Grant&#8217;s 1st Birthday, we&#8217;ve been doing quite a lot as a family. Second, I&#8217;ve been scrambling to finish off Wendy&#8217;s stationery store site, and I&#8217;m pleased to announce that <a href="http://www.duckduckgoosedesigns.com">http://www.duckduckgoosedesigns.com</a> went into production on Memorial Day!</p>

<p>Last of all, I&#8217;ve been putting the finishing touches on my two lightning talks for Community One and my Java.net Community Corner podcast. In fact, I recorded the last demo video for my Google App Engine talk as I sat here in the Intercontinental Hotel.</p>

<p>At any rate, I&#8217;ve got a packed schedule ahead, full of technical sessions, BOF&#8217;s, meetups, parties, etc. It&#8217;s the ultimate geek vacation. Stay tuned as I blog my way through. You can also pickup my Twitter feed for up-to-the-minute news. ;-)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/05/11/grails-paypal-plugin-update/">Grails PayPal Plugin Update</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-11T16:16:48-05:00" pubdate data-updated="true">May 11<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I last posted on <a href="http://www.mattstine.com/2009/05/02/ive-forked-the-grails-paypal-plugin/">my fork of the Grails PayPal Plugin</a>, I&#8217;ve been invited to be a committer on the <a href="http://xircles.codehaus.org/projects/grails-plugins">Grails Plugins project at the Codehaus</a>. I&#8217;ll be incorporating my changes into the SVN repository there and updating the documentation on the main Grails Plugins website. Look for these updates coming soon!!!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/05/11/career-20-toastmasters/">Career 2.0: Toastmasters</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-11T15:59:31-05:00" pubdate data-updated="true">May 11<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m currently making my second trip through <a href="http://agileartisans.com/main">Jared Richardson&#8217;s</a> excellent book <a href="http://www.lulu.com/content/5925115">Career 2.0: Take Control of Your Life</a>. In the &#8220;Public Speaking&#8221; chapter, one of the recommended avenues for public speaking practice is <a href="http://www.toastmasters.org">Toastmasters</a>. I first heard of Toastmasters&#8230;you guessed it, on my first trip through the book. Shortly after returning home from <a href="http://www.nofluffjuststuff.com/conference/st_louis/2009/03/index.html">NFJS St. Louis</a>, I decided to see if I could find a local club. Lo and behold, a Toastmasters club already meets on the St. Jude Children&#8217;s Research Hospital campus! I had no excuse but to check it out at this point.</p>

<p>For the uninitiated, Toastmasters is an organization focused on helping individuals hone their communication and leadership skills in a safe environment. This is accomplished primarily through three different avenues:</p>

<ul>
<li><p>Serving in one of the meeting leadership roles, such as Toastmaster (the meeting facilitator);</p></li>
<li><p>Giving a prepared speech/talk from the list of speech projects in the Toastmasters &#8220;coursework&#8221;;</p></li>
<li><p>Speaking extemporaneously on one of several &#8220;table topics,&#8221; which are speaking prompts provided during the meeting.</p></li>
</ul>


<p>Participation in any of these avenues is immediately followed up with feedback from one or more people playing various &#8220;evaluator&#8221; roles. I couldn&#8217;t help but see the parallels to agile software development!</p>

<p>I&#8217;ve now attended three meetings, and at the last meeting I decided to join up. The St. Jude club is an extremely friendly group, and several of its members are very accomplished public speakers. You can definitely tell that the Toastmasters experience has helped them enhance their communications skills. I&#8217;m looking forward to polishing my own.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/05/02/ive-forked-the-grails-paypal-plugin/">I&#8217;ve &#8220;Forked&#8221; the Grails PayPal Plugin&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-02T00:59:46-05:00" pubdate data-updated="true">May 2<span>nd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m currently completing the finishing touches on a new e-commerce site for my wife&#8217;s stationary business. We decided a long time ago to use <a href="http://www.paypal.com">PayPal</a> for all of the payment processing since we&#8217;ve had a great experience using it for our eBay selling. About a year ago Graeme Rocher polished off the last release of a <a href="http://grails.org/plugin/paypal">PayPal plugin</a> that is available in <a href="http://grails.org/plugin/home">the Grails Plugin repository</a>. It really is a very nice plugin, yet I had a couple of problems with it:</p>

<ul>
<li><p>It is only capable of handling payments for one item transactions via &#8220;Buy Now&#8221; buttons. I want to upload an entire shopping cart full of multiple items.</p></li>
<li><p>It currently won&#8217;t handle shipping addresses. The site I&#8217;m building allows the user to maintain a list of shipping addresses, and I&#8217;d want to send the address information they choose along to PayPal.</p></li>
<li><p>Minor issue: needed to upgrade the plugin to Grails 1.1.</p></li>
</ul>


<p>So, I decided this evening to fork the plugin. I want to leverage all of the great work that has been done thus far (especially with the IPN processing part - superb stuff), but I have to add in these two functions and do the version upgrade. Interestingly enough I couldn&#8217;t get the tests to run out of the box after the upgrade. No good developer likes to modify code without a stable running test suite, right? So what I ended up doing was creating a new Grails 1.1 plugin project and copying the original artifacts over. Once this was done all of the tests ran perfectly.</p>

<p>So, at this point I&#8217;ve added function #1. You can now redirect to the &#8220;uploadCart&#8221; action. It assumes that you have already constructed a Payment object (now containing PaymentItems) and saved it, and then passed the transactionId along. I did this so that folks with multiple different ways of handling shopping carts could have some degree of flexibility - the onus is on you to map your cart to your Payment object correctly. The original functions implemented by Graeme are backward compatible, assuming only one PaymentItem in the Payment. I&#8217;ve run all of the original tests and also did some manual functional testing by running the plugin app against my own PayPal Sandbox account. So far so good. Look for more updates as this evolves. Once I get something I&#8217;m totally happy with I&#8217;ll see about getting it pushed back into the main plugin repo.</p>

<p>Want to take a closer look? Visit <a href="http://github.com/mstine/grails-paypal-plugin/tree/master">http://github.com/mstine/grails-paypal-plugin/tree/master</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/04/30/functional-programming-blog-aggregator-in-the-works/">Functional Programming Blog Aggregator in the Works&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-30T13:31:58-05:00" pubdate data-updated="true">Apr 30<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So I&#8217;m in the midst of planning my next toy project, specifically with an aim to build something for the cloud, be it <a href="http://code.google.com/appengine">Google App Engine</a>, <a href="http://mor.ph">Mor.ph</a>, <a href="http://aws.amazon.com/ec2/">EC2</a>, etc. (that part is still up for grabs). What I&#8217;d like to do is an opt-in blog aggregation site focused around functional programming. It would be very similar to what <a href="http://blogs.bytecode.com.au/glen/">Glen Smith</a> has done with <a href="http://groovyblogs.org">groovyblogs.org</a>. Groovyblogs is currently my number one referral site and is generating about 20% of the traffic for this blog. I think it is a great way to find out what blogs are out there in a given space, and there doesn&#8217;t seem to be an equivalent for the functional space. Since my LOTY interest is focused in the functional space, particularly around Scala and Clojure, and my TOTY interest is the cloud technologies out there, it seems like the perfect marriage.</p>

<p>So here&#8217;s my question. Would you be interested in using such a site? As a reader, blogger, or both? Please sound off. Thanks!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/04/27/joels-builderbuilder-in-groovy/">Joel&#8217;s BuilderBuilder in Groovy</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-27T21:54:07-05:00" pubdate data-updated="true">Apr 27<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://joelneely.wordpress.com/">Joel Neely</a> started <a href="http://joelneely.wordpress.com/2009/04/25/builderbuilder-the-agenda/">a series</a> <a href="http://joelneely.wordpress.com/2009/04/27/builderbuilder-the-task/">of posts</a> over the weekend detailing a proposed exploration of what Functional Programming means &#8220;to me as a practicing OO software developer?&#8221; The task at hand is to look at the generation of Data Transfer Objects which include a static inner class that functions as a builder. Since I&#8217;m exploring both Clojure and Scala right now, Joel has asked me to play along.</p>

<p>After reading the task definition today, I couldn&#8217;t resist taking a crack at the problem in Groovy, especially since tackling a Builder DSL is not something I&#8217;ve gone after before.</p>

<p>So, here&#8217;s how I&#8217;ll use my DTOBuilder to produce the output Joel described:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">def</span> <span class="n">bldr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DtoBuilder</span><span class="o">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">println</span> <span class="n">bldr</span><span class="o">.</span><span class="na">build</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">packageName</span> <span class="err">&#39;</span><span class="n">edu</span><span class="o">.</span><span class="na">bogusu</span><span class="o">.</span><span class="na">registration</span><span class="err">&#39;</span>
</span><span class='line'>  <span class="n">name</span> <span class="err">&#39;</span><span class="n">Student</span><span class="err">&#39;</span>
</span><span class='line'>  <span class="n">field</span><span class="o">(</span><span class="nl">name:</span><span class="err">&#39;</span><span class="n">id</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">type:</span><span class="err">&#39;</span><span class="n">String</span><span class="err">&#39;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">field</span><span class="o">(</span><span class="nl">name:</span><span class="err">&#39;</span><span class="n">firstName</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">type:</span><span class="err">&#39;</span><span class="n">String</span><span class="err">&#39;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">field</span><span class="o">(</span><span class="nl">name:</span><span class="err">&#39;</span><span class="n">lastName</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">type:</span><span class="err">&#39;</span><span class="n">String</span><span class="err">&#39;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">field</span><span class="o">(</span><span class="nl">name:</span><span class="err">&#39;</span><span class="n">hoursEarned</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">type:</span><span class="err">&#39;</span><span class="kt">int</span><span class="err">&#39;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">field</span><span class="o">(</span><span class="nl">name:</span><span class="err">&#39;</span><span class="n">gpa</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">type:</span><span class="err">&#39;</span><span class="kt">float</span><span class="err">&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Pretty concise, eh? <a href="http://github.com/mstine/BuilderBuilder/blob/1008235f88177910eb94af165ade3aedae2955a3/src/DtoBuilder.groovy">Check out the implementation of it at GitHub</a>. I&#8217;ll be posting all of my code related to this series at this location (and hopefully Joel will join in as well).</p>

<p>One thing you&#8217;ll notice is that I&#8217;m still operating primarily in OO style. My next task is to refactor this code, still written in Groovy, but using as much functional-style as I can squeeze out of the language. Until next time&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/04/25/groovy-post-to-a-url/">Groovy: Post to a URL</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-25T23:09:11-05:00" pubdate data-updated="true">Apr 25<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you&#8217;ve ever worked with the brilliant <a href="http://recaptcha.net/">Recaptcha</a> service, you&#8217;ll know that their REST API requires an HTTP POST rather than a GET. As I had only used GET requests thus far, I googled around and found a pretty easy solution:</p>

<pre><code>private def evaluateCaptcha(def remoteIp, def challenge, def response) {
    def config = recaptchaService.getRecaptchaConfig()

    def urlString = "http://api-verify.recaptcha.net/verify"
    def queryString = "privatekey=${config.recaptcha.privateKey}&amp;remoteip=${remoteIp}&amp;challenge=${challenge}&amp;response=${URLEncoder.encode(response)}"

    def url = new URL(urlString)
    def connection = url.openConnection()
    connection.setRequestMethod("POST")
    connection.doOutput = true

    def writer = new OutputStreamWriter(connection.outputStream)
    writer.write(queryString)
    writer.flush()
    writer.close()
    connection.connect()

    def recaptchaResponse = connection.content.text
    log.debug(recaptchaResponse)

    recaptchaResponse.startsWith("true")
}
</code></pre>

<p>I have to credit <a href="http://www.fiascode.com/programming/putting-google-finance-to-rest-with-groovy/">Justin Spradlin</a> for the code that ultimately got me here. Consider this a +1.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/04/25/grails-prototype-scriptaculous-persistent-grid-sorting-goodness/">Grails, Prototype, Script.aculo.us - Persistent Grid Sorting Goodness</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-25T00:14:40-05:00" pubdate data-updated="true">Apr 25<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ever wanted to do drag-n-drop sorting of a grid of images on a page and persist it? Here&#8217;s my solution using Grails, Prototype, and Script.aculo.us.</p>

<p>Basically what prompted this was the need for my wife to be able to sort the various product images that she had on a screen at any given time in any way that she pleased, and it had to be easy to work with. What follows is by no means a complete solution to this problem, but it represents where I am in the development process and may be useful to you, my hapless reader.</p>

<p>Here&#8217;s some GSP code which basically lays out a grid of product images, 3 wide by <em>n</em> deep:</p>

<pre><code>&lt;div id="productThumbContainer"&gt;
  &lt;g:set var="rowIndex" value="${0}"/&gt;
&lt;g:each in="${products}" var="product" status="index"&gt;
  &lt;g:if test="${index % 3 == 0}"&gt;
    &lt;div id="productRow${rowIndex}" class="span-20 last product-row"&gt;
  &lt;/g:if&gt;
  &lt;div id="product_${product.id}" class="span-6 product &lt;g:if test="${(index % 3 == 2) || ((products.size() - index) == 1)}"&gt;last&lt;/g:if&gt;&lt;g:else&gt;append-1&lt;/g:else&gt;"&gt;
    &lt;img src="${resource(dir: grailsApplication.config.store.productImages.webPath, file: product?.thumbnailImage?.name)}" width="230" class="productImage"&gt;
    &lt;h3&gt;&lt;g:link controller="product" action="show" id="${product.id}"&gt;${product.name}&lt;/g:link&gt;&lt;/h3&gt;
  &lt;/div&gt;
  &lt;g:if test="${(index % 3 == 2) || ((products.size() - index) == 1)}"&gt;
    &lt;/div&gt;
    &lt;g:set var="rowIndex" value="${rowIndex + 1}"/&gt;
  &lt;/g:if&gt;
&lt;/g:each&gt;
&lt;/div&gt;
</code></pre>

<p>Now here&#8217;s where the magic happens:</p>

<pre><code>document.observe('dom:loaded', function() {
      var productRows = $$('.product-row');

      var options = {
        constraint: false,
        overlap: 'horizontal',
        containment: productRows,
        dropOnEmpty: true,
        tag: 'div',
        onUpdate: updateRows
      };

      productRows.each(function(item) {
        Sortable.create(item, options);
      });

      $('persistOrderingButton').observe('click', function(event) {
          var sortString = '';
          productRows.each(function(row) {
              sortString += '&amp;';
              sortString += Sortable.serialize(row);
          });
          &lt;g:remoteFunction action="sortProducts" params="sortString" update="ajaxMessage" onSuccess="\$('ajaxMessage').show()"/&gt;
      });
});
</code></pre>

<p>What we&#8217;ve got here is, failure to communicate&#8230;oops, wrong synapse there&#8230;what we&#8217;ve got here is a Prototype selector that grabs everything with the class &#8220;.product-row.&#8221; It then takes these and creates a Scriptaculous Sortable for each of them, providing the object-literal &#8220;options.&#8221; Notice the &#8220;containment&#8221; option which allows you to drag products back and forth between the various rows.</p>

<p>Delving deeper into the magic is the callback function &#8220;updateRows.&#8221; This guy is my favorite Javascript creation in quite some time:</p>

<pre><code>function updateRows(list) {
      var children = list.childElements();

      if (children.size() &lt; 3) {

        //If I'm the last row, who cares!
        if (list.next() != null) {
          var prevRow = list.previous();

          if (prevRow != null) {
            var lastChild = prevRow.childElements()[prevRow.childElements().size() - 1].remove();
            list.insert({top:lastChild});
            updateRows(prevRow);
          } else {
            var lastRow = list.up().childElements()[list.up().childElements().size() - 1];
            var lastChild = lastRow.childElements()[lastRow.childElements().size() - 1].remove();
            list.insert({top:lastChild});
            updateRows(lastRow);
          }
        }
      } else if (children.size() == 3) {
        //Do nothing...gets me out of the recursion I hope!
      } else {
        var nextRow = list.next();
        var lastChild = children[children.size() - 1].remove();

        if (nextRow != null) {
          nextRow.insert({top:lastChild});
          updateRows(nextRow);
        } else {
          var topRow = list.up().childElements()[0];
          topRow.insert({top:lastChild});
          updateRows(topRow);
        }
      }

      var i = 0;
      Sortable.sequence(list).each(function(item) {
        var productId = 'product_' + item;
        if (i &lt; 2) {
          $(productId).removeClassName('last');
          $(productId).removeClassName('append-1');
          $(productId).addClassName('append-1');
        } else {
          $(productId).removeClassName('last');
          $(productId).removeClassName('append-1');
          $(productId).addClassName('last');
        }
        i++;
      });
}
</code></pre>

<p>This function is organized around the fact that the only valid state for a grid of n-rows will be n-1 rows of 3 products, followed by one row of 1 &lt;= numProducts &lt;= 3. In most cases, if you drag a product from one row to another, you are violating that rule by creating a row with 2 products and a row with 4 products. This function solves the problem by recursively shifting the products down until reaching a stable state again.</p>

<p>There&#8217;s a bit of noise there at the bottom of the function. I&#8217;m using Blueprint CSS to do the layout for this application and I need to shift the various Blueprint classes around once everything is settled.</p>

<p>Finally, here&#8217;s the persistence of the data when we click save:</p>

<pre><code>def sortProducts = {
    TreeMap rowMap = new TreeMap()

    params.each {key, value -&gt;
      def matcher = key =~ /productRow(.*)\[\]/
      if (matcher.matches()) {
        def rowId = matcher[0][1]
        rowMap[rowId] = value
      }
    }

    def productIds = []
    rowMap.values().each { row -&gt;
      row.each {
        productIds &lt;&lt; it.toLong()
      }
    }

    shoppingService.saveSortOrder(productIds)

    render("Product sort order saved!")
}
</code></pre>

<p>and the logic from shoppingService.saveSortOrder():</p>

<pre><code>def saveSortOrder(def productIds) {
    def productsToSort = Product.findAllByIdInList(productIds)

    def productMap = [:]
    def sortIndexList = []

    productsToSort.each {
      productMap[it.id] = it
      sortIndexList &lt;&lt; it.sortIndex
    }

    sortIndexList.sort()
    sortIndexList = sortIndexList.reverse()

    productIds.each {
      productMap[it].sortIndex = sortIndexList.pop()
    }

    productsToSort.each {
      it.save()
    }
}
</code></pre>

<p>You might wonder why this is so complex. What I haven&#8217;t fully described is the way products are organized into a hierarchy of various categories. When you&#8217;re sorting a screen, you&#8217;re only sorting a subset of the products that are in that particular category. However, the sort order is maintained across the entire product set in the database. So, this logic basically just shifts around the existing sort indicies, placing them in their new relative order.</p>

<p>Anyway, I don&#8217;t know how generally applicable this code is, but I had fun writing it and I hope you can get some use out of it. Cheers!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
	<h1>Hello, World!</h1>
	<p>
		<img src="http://mattstine.files.wordpress.com/2011/05/indiamug.jpg" width="173" height="213">
	</p>
	<p>
		<a href="http://www.linkedin.com/in/mattstine"><img alt="View Matt Stine&#039;s profile on LinkedIn" src="http://www.linkedin.com/img/webpromo/btn_myprofile_160x33.gif" border="0" width="160" height="33"></a>
	</p>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/06/30/microservices-are-solid/">Microservices are SOLID</a>
      </li>
    
      <li class="post">
        <a href="/2013/08/02/bosh-and-cloud-api-compatibility/">BOSH and Cloud API Compatibility</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/10/blue-green-deployments-on-cloudfoundry/">Blue-Green Deployments on Cloud Foundry</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/29/clojure-on-cloud-foundry/">Clojure on Cloud Foundry</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/29/into-the-crucible/">Into the Crucible</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("mstine", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/mstine" class="twitter-follow-button" data-show-count="false">Follow @mstine</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Matt Stine -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'seekingsimplicity';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
